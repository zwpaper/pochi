name: Test vscode-webui

on:
  workflow_dispatch:
    inputs:
      runs:
        description: "Number of test runs (to check for flaky tests)"
        required: false
        default: "5"
        type: string

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: Install dependencies
        run: bun install --frozen-lockfile

      - name: Run vscode-webui tests
        run: |
          echo "Running tests ${{ inputs.runs }} times to check for flakiness..."
          for i in $(seq 1 ${{ inputs.runs }}); do
            echo ""
            echo "=========================================="
            echo "Test run $i of ${{ inputs.runs }}"
            echo "=========================================="
            bun turbo test --filter=@getpochi/vscode-webui --force
          done
          echo ""
          echo "All ${{ inputs.runs }} test runs completed successfully!"
